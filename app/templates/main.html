{% extends "base.html" %}

{% block main %}
  <div class="mdl-grid">
    <div class="mdl-cell mdl-cell--4-col">
      <h5>Today - {{ today.strftime("%a, %d %b '%y")}}</h5>

        <div id="time_log" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
        <span id="progress" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></span>
        {% for category in today_categories %}
          {% set cat_bar = [category, 'bar']|join('_') %}
          {% set cat_table = [category, 'table']|join('_') %}
          <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--4-col mdl-cell--8-col-tablet">
                  {{ divs[cat_bar] | safe }}
            </div>
            <div class="mdl-cell mdl-cell--8-col mdl-cell--8-col-tablet">
                  {{ today_tables[cat_table] | safe }}
            </div>
          </div>
        {% endfor %}
    </div>
    <div class="mdl-cell mdl-cell--8-col">
        <div id="all_time_line" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
        <div id="detail_time_line" class""></div>
      {% include 'timesheet.html' %}
    </div>
  </div>
{% endblock main %}


{% block js %}

  <script type="text/javascript">
    {% include 'js/resize_plots.js' %}

    function replace_progress() {
      $("#progress").replaceWith('');
      {% for key in divs.keys() %}
        $("#{{ key }}").replaceWith('{{ divs[key] | safe }}');
      {% endfor %}
    }

    // Once retrieved bokeh: replace the progress bars, run bokeh script, initial resize of plots
    bokehJS.done( function () {
      replace_progress();
      {{ script|safe }}
      resize_plots();
      {% include 'js/timesheet.js' %}
    });
  </script>

{% endblock js %}
